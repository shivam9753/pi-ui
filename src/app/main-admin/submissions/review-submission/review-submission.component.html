<div class="bg-white min-h-screen">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6">

    <!-- Navigation Bar (Back + Prev/Next) -->
    <div class="mb-6 flex items-center justify-between gap-4 pb-4 border-b border-gray-200">
      <button
        (click)="goBackToPendingReviews()"
        class="flex items-center gap-2 px-3 py-2 text-sm text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
        Back to Reviews
      </button>

      <div class="flex items-center gap-2">
        <button
          (click)="goToPrevious()"
          [disabled]="!hasPrevious || isLoadingNavigation"
          class="p-2 text-gray-600 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
        </button>

        <ng-container *ngIf="getCurrentSubmissionInfo()">
          <span class="text-xs text-gray-500 px-2 hidden sm:inline">{{ getCurrentSubmissionInfo() }}</span>
        </ng-container>

        <button
          (click)="goToNext()"
          [disabled]="!hasNext || isLoadingNavigation"
          class="p-2 text-gray-600 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Article Header -->
    <header class="mb-8">
      <h1 class="text-3xl sm:text-4xl lg:text-5xl font-serif font-bold text-gray-900 leading-tight mb-4 mt-4">
        {{ submission?.title }}
      </h1>

      <ng-container *ngIf="submission?.description">
        <div class="mb-6">
          <p class="text-lg sm:text-xl text-gray-700 leading-relaxed font-light italic border-l-4 border-primary pl-4 sm:pl-6"
             style="font-family: 'Crimson Text', Georgia, serif;">
            {{ submission?.description }}
          </p>
        </div>
      </ng-container>

      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 pb-6 border-b border-gray-200">
        <div>
          <div class="text-base sm:text-lg font-medium text-gray-900">
            <span>by</span>
            <ng-container *ngIf="submission?.userId">
              <button
                (click)="viewUserProfile(submission.userId)"
                class="ml-1 text-gray-800 hover:text-gray-900 hover:underline cursor-pointer transition-colors duration-200">
                {{ submission.userId.name }}
              </button>
            </ng-container>
          </div>
          <div class="text-sm text-gray-600 mt-1">
            {{ submission?.createdAt | date:'MMMM d, y' }}
          </div>
        </div>

        <div class="flex flex-wrap items-center gap-2">
          <app-status-badge [status]="submission?.status" size="md"></app-status-badge>
          <app-status-badge [status]="submission?.submissionType" size="sm"></app-status-badge>
          <ng-container *ngIf="submission?.isFeatured">
            <app-status-badge status="featured" size="sm" [showIcon]="true"></app-status-badge>
          </ng-container>
        </div>
      </div>
    </header>

    <!-- Existing Review -->
    <ng-container *ngIf="existingReview">
      <div class="mb-8 bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 13V5a2 2 0 00-2-2H4a2 2 0 00-2 2v8a2 2 0 002 2h3l3 3 3-3h3a2 2 0 002-2zM5 7a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1zm1 3a1 1 0 100 2h3a1 1 0 100-2H6z" clip-rule="evenodd"/>
          </svg>
          Review by {{ existingReview.reviewerName }}
        </h3>
        <div class="space-y-3">
          <div class="flex items-center gap-4 text-sm">
            <span class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium"
              [ngClass]="{
                'bg-green-100 text-green-800 border border-green-300': existingReview.status === 'accepted',
                'bg-red-100 text-red-800 border border-red-300': existingReview.status === 'rejected'
              }">
              {{ existingReview.status | titlecase }}
            </span>
            <span class="text-gray-600">{{ existingReview.reviewedAt | date:'medium' }}</span>
          </div>
          <div class="bg-gray-50 rounded-lg p-4 border-l-4 border-gray-300">
            <p class="text-gray-900 whitespace-pre-line">{{ existingReview.reviewNotes }}</p>
          </div>
        </div>
      </div>
    </ng-container>

    <!-- Main Content -->
    <ng-container *ngIf="submission && submission.contents && submission.contents.length > 0; else noContent">
      <div class="prose-custom mb-12">
        <ng-container *ngFor="let content of submission.contents; let i = index">
          <article class="content-section mb-12">
            <ng-container *ngIf="submission.contents.length > 1">
              <h2 class="text-2xl sm:text-3xl font-serif font-bold text-gray-900 mb-6 pb-3 border-b border-gray-200">
                {{ i + 1 }}. {{ content.title }}
              </h2>
            </ng-container>

            <div class="flex flex-wrap gap-4 text-sm text-gray-600 mb-6">
              <span class="flex items-center gap-1">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd" />
                </svg>
                <span class="font-medium text-gray-800">{{ content.wordCount || getWordCount(content.body) }}</span> words
              </span>
            </div>

            <div class="content-body reading-text mb-8"
              style="font-size: 18px; line-height: 1.7; letter-spacing: 0.2px;"
              [innerHTML]="cleanContent(content.body)">
            </div>

            <ng-container *ngIf="content.footnotes">
              <div class="mt-6 p-4 bg-gray-50 rounded-lg border-l-4 border-blue-200">
                <h4 class="text-sm font-medium text-gray-900 mb-2">Footnotes:</h4>
                <p class="text-sm text-gray-700 whitespace-pre-wrap">{{ content.footnotes }}</p>
              </div>
            </ng-container>
          </article>
        </ng-container>
      </div>
    </ng-container>

    <ng-template #noContent>
      <div class="mb-12 bg-yellow-50 border border-yellow-300 rounded-lg p-6">
        <div class="flex items-center justify-center mb-2">
          <svg class="w-6 h-6 text-primary mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <h3 class="text-lg font-medium text-amber-800">No Content Available</h3>
        </div>
        <p class="text-amber-700 text-center">This submission doesn't have any content items to display.</p>
      </div>
    </ng-template>

    <!-- Review Actions Section -->
    <ng-container *ngIf="canReviewSubmission()">
      <div class="mb-8 pt-8 border-t-2 border-gray-300">

        <!-- Start Review (pending_review only) -->
        <ng-container *ngIf="canStartReview()">
          <div class="text-center py-8">
            <p class="text-gray-700 mb-4">This submission is awaiting review.</p>
            <app-button
              variant="info-soft"
              size="md"
              [disabled]="isSubmitting"
              (click)="startReviewProcess()">
              Start Review
            </app-button>
          </div>
        </ng-container>

        <!-- Review Action Buttons (in_progress, resubmitted) -->
        <ng-container *ngIf="canShowActionButtons() && !showReviewForm">
          <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
            <h3 class="text-lg font-semibold text-gray-900 mb-4 text-center">Choose Review Action</h3>

            <div class="flex flex-col sm:flex-row gap-3 justify-center max-w-xl mx-auto">
              <ng-container *ngIf="canApproveSubmissions()">
                <app-button
                  variant="success-soft"
                  size="md"
                  [fullWidth]="true"
                  [disabled]="isSubmitting"
                  (click)="setReviewAction('approve')">
                  Accept
                </app-button>
              </ng-container>

              <ng-container *ngIf="isActionAllowed('reject')">
                <app-button
                  variant="destructive-soft"
                  size="md"
                  [fullWidth]="true"
                  [disabled]="isSubmitting"
                  (click)="setReviewAction('reject')">
                  Reject
                </app-button>
              </ng-container>

              <ng-container *ngIf="isActionAllowed('revision')">
                <app-button
                  variant="warning-soft"
                  size="md"
                  [fullWidth]="true"
                  [disabled]="isSubmitting"
                  (click)="setReviewAction('revision')">
                  Ask for Revision
                </app-button>
              </ng-container>
            </div>
          </div>
        </ng-container>

        <!-- Review Form -->
        <ng-container *ngIf="showReviewForm">
          <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
            <label for="reviewNotes" class="block text-base font-semibold text-gray-900 mb-3">Review Notes</label>
            <textarea id="reviewNotes" rows="6" class="w-full p-3 border border-gray-300 rounded-md" placeholder="Enter your review notes here..."></textarea>

            <div class="mt-4 flex items-center gap-3">
              <app-button variant="primary" (click)="submitReview()" [disabled]="isSubmitting">Submit Review</app-button>
              <app-button variant="tertiary" (click)="cancelReview()">Cancel</app-button>
            </div>
          </div>
        </ng-container>

      </div>
    </ng-container>

  </div>
</div>

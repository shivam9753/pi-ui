<!-- Header & Description -->
<div class="max-w-4xl mx-auto px-6 mb-6 mt-10">
  <h1 class="text-2xl md:text-3xl font-extrabold text-gray-900 mb-2">Writing Prompts</h1>
  <p class="text-gray-600 text-base">
    Find inspiration, challenge yourself, and discover new ideas to kickstart your next literary creation.
  </p>
</div>

<!-- Tabs Navigation -->
<nav class="flex justify-center space-x-12 mb-8 border-b border-gray-200 max-w-4xl mx-auto px-6">
  <button
    type="button"
    (click)="setActiveTab('discover')"
    [class.border-orange-500]="activeTab === 'discover'"
    [class.text-orange-600]="activeTab === 'discover'"
    [class.border-transparent]="activeTab !== 'discover'"
    [class.text-gray-900-secondary]="activeTab !== 'discover'"
    class="whitespace-nowrap py-3 px-4 border-b-2 font-medium transition-colors duration-200"
  >
    Discover
  </button>
  <button
    type="button"
    (click)="setActiveTab('gamified')"
    [class.border-orange-500]="activeTab === 'gamified'"
    [class.text-orange-600]="activeTab === 'gamified'"
    [class.border-transparent]="activeTab !== 'gamified'"
    [class.text-gray-900-secondary]="activeTab !== 'gamified'"
    class="whitespace-nowrap py-3 px-4 border-b-2 font-medium transition-colors duration-200"
  >
    Gamified
  </button>
  <button
    type="button"
    (click)="setActiveTab('guidelines')"
    [class.border-orange-500]="activeTab === 'guidelines'"
    [class.text-orange-600]="activeTab === 'guidelines'"
    [class.border-transparent]="activeTab !== 'guidelines'"
    [class.text-gray-900-secondary]="activeTab !== 'guidelines'"
    class="whitespace-nowrap py-3 px-4 border-b-2 font-medium transition-colors duration-200"
  >
    Guidelines
  </button>
</nav>

<!-- Discover Tab -->
<div *ngIf="activeTab === 'discover'" class="max-w-4xl mx-auto px-6">
  <!-- Filters Section -->
  <div class="mb-6">
    <h2 class="text-lg font-semibold text-gray-900 mb-4">Filter Prompts</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-900 mb-2">Type</label>
        <select [(ngModel)]="browseType" (ngModelChange)="onBrowseFilterChange()" class="form-input w-full rounded-md">
          <option value="">All Types</option>
          <option value="poem">Poem</option>
          <option value="prose">Prose</option>
          <option value="article">Article</option>
          <option value="cinema_essay">Cinema Essay</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-900 mb-2">Difficulty</label>
        <select [(ngModel)]="browseDifficulty" (ngModelChange)="onBrowseFilterChange()" class="form-input w-full rounded-md">
          <option value="">All Levels</option>
          <option value="beginner">Beginner</option>
          <option value="intermediate">Intermediate</option>
          <option value="advanced">Advanced</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-900 mb-2">Search Text</label>
        <input
          type="text"
          [(ngModel)]="browseTextFilter"
          (ngModelChange)="onBrowseFilterChange()"
          placeholder="Search in title, description, tags..."
          class="form-input w-full rounded-md"
        />
      </div>
    </div>
  </div>

  <!-- Prompts List -->
  <div *ngIf="filteredPrompts.length > 0" class="space-y-6">
    <div
      *ngFor="let prompt of filteredPrompts"
      class="p-6 bg-white border border-orange-50 rounded-2xl shadow hover:shadow-md transition-all"
    >
      <div class="flex gap-3 items-center mb-2">
        <span class="inline-flex items-center bg-orange-50 text-orange-600 font-medium px-3 py-1 rounded-full text-xs">{{ getTypeLabel(prompt.type) }}</span>
        <span class="inline-flex items-center px-3 py-1 rounded-full font-medium text-xs"
          [ngClass]="getDifficultyColor(prompt.difficulty || '')">
          {{ prompt.difficulty | titlecase }}
        </span>
        <span *ngIf="prompt.featured" class="ml-2 bg-yellow-100 text-orange-700 font-semibold px-2 py-1 text-xs rounded-full">⭐ Featured</span>
      </div>
      <h3 class="text-base font-bold text-orange-900">{{ prompt.title }}</h3>
      <div class="text-gray-700 text-sm mt-1">{{ prompt.description }}</div>
      <div *ngIf="prompt.tags?.length" class="flex flex-wrap gap-1 mt-2">
        <span *ngFor="let tag of prompt.tags"
          class="bg-orange-50 border border-orange-100 text-orange-600 font-medium px-2 py-1 text-xs rounded-xl">
          #{{ tag }}
        </span>
      </div>
    </div>
  </div>
  <div *ngIf="filteredPrompts.length === 0" class="text-center text-gray-500 py-8 mt-8 text-lg">
    No prompts found for the current filters.
  </div>
</div>

<!-- Gamified Tab -->
<div *ngIf="activeTab === 'gamified'" class="max-w-3xl mx-auto px-6">
  <div *ngIf="currentPrompt"
    class="bg-white border border-gray-200 rounded-3xl shadow-lg px-8 py-10 mb-10 flex flex-col items-center transition-all duration-300">
    <div class="flex gap-3 mb-5">
      <span class="inline-flex items-center bg-orange-50 font-medium text-orange-600 px-4 py-2 rounded-full capitalize text-sm">
        {{ getTypeLabel(currentPrompt.type) }}
      </span>
      <span
        class="inline-flex items-center px-4 py-2 rounded-full font-medium text-xs"
        [ngClass]="getDifficultyColor(currentPrompt.difficulty || '')">
        {{ currentPrompt.difficulty | titlecase }}
      </span>
      <span *ngIf="currentPrompt.featured"
        class="inline-flex items-center bg-yellow-100 text-orange-700 font-semibold text-xs px-3 py-1 rounded-full ml-1">⭐ Featured</span>
    </div>
    <h2 class="text-2xl md:text-3xl font-bold text-orange-900 mb-3 text-center">
      {{ currentPrompt.title }}
    </h2>
    <p class="text-base md:text-lg text-orange-800 mb-5 leading-relaxed text-center">
      {{ currentPrompt.description }}
    </p>
    <div *ngIf="currentPrompt.tags?.length" class="flex flex-wrap justify-center gap-2 mb-4">
      <span *ngFor="let tag of currentPrompt.tags"
        class="bg-orange-50 border border-orange-100 text-orange-600 font-medium px-2 py-1 text-xs rounded-xl">
        #{{ tag }}
      </span>
    </div>
    <div *ngIf="!!currentPrompt.picture" class="mb-5">
      <img
        [src]="currentPrompt.picture"
        [alt]="currentPrompt.title || 'Prompt image'"
        class="mx-auto rounded-xl max-h-56 object-cover border-2 border-orange-100">
    </div>
    <ng-container *ngIf="filteredPrompts && filteredPrompts.length > 1 && promptIndex >= 0">
      <span class="text-orange-500 text-xs mt-2 mb-4 tracking-wide block">
        {{ promptIndex + 1 }} of {{ filteredPrompts.length }} prompts in this session
      </span>
    </ng-container>
    <button
      type="button"
      (click)="refreshPrompt()"
      [disabled]="isRefreshing"
      class="mt-4 w-full sm:w-auto rounded-2xl bg-orange-500 hover:bg-orange-400 transition-all text-white font-medium sm:font-semibold px-8 py-4 text-base md:text-lg shadow-lg focus:outline-none focus:ring-2 ring-orange-200 ring-offset-2 active:scale-98"
      [ngClass]="{ 'opacity-70': isRefreshing }">
      <span *ngIf="!isRefreshing">New Prompt</span>
      <svg *ngIf="isRefreshing" class="animate-spin w-6 h-6 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10" stroke-width="3" class="opacity-25" />
        <path d="M4 12a8 8 0 018-8" stroke-width="3" class="opacity-75" />
      </svg>
    </button>
    <div *ngIf="currentPrompt.usageCount" class="mt-4 text-xs text-orange-600">
      Used by <span class="font-semibold">{{ currentPrompt.usageCount }}</span> writers
    </div>
  </div>
  <div *ngIf="!currentPrompt" class="text-center py-12 text-gray-600 italic">
    No prompt available. Try changing filters or refresh.
  </div>
</div>

<!-- Guidelines Overlay Modal -->
<div *ngIf="activeTab === 'guidelines'" class="px-6 py-8 lg:px-8">
    <div class="max-w-4xl mx-auto">
      <app-guidelines-overlay
        [isInline]="true"
      ></app-guidelines-overlay>
    </div>
  </div>

<div class="min-h-screen bg-white -mt-4">


  @if (content()) {
    <main class="w-full lg:w-2/3 xl:w-3/5 mx-auto px-2 sm:px-4 md:px-6 lg:px-8">
      <!-- Main Content Grid -->
      <div class="w-full mt-4 pb-4">
        <div class="flex flex-col gap-8">
          <!-- Main Content Column -->
          <div role="main" class="col-span-12 lg:col-span-8 mx-auto">
            <!-- Article Header -->
            <header class="mb-4 relative reading-header">
              <!-- Desktop Controls - Positioned relative to content -->
              <div class="hidden md:flex absolute -top-2 right-0 gap-1">
               
              </div>

              <!-- Mobile Controls - Moved to bottom -->
              <div class="md:hidden"></div>
              <!-- Category badge -->
              <div class="mb-4 flex justify-center">
                <app-badge-label
                  [type]="content()!.submissionType"
                  badgeType="type"
                  [clickable]="true"
                  variant="big-red"
                  (badgeClick)="navigateToCategory($event)">
                </app-badge-label>
              </div>
              <h1 class="text-2xl sm:text-3xl lg:text-4xl xl:text-5xl font-serif font-bold text-gray-900 leading-tight mb-3 sm:mb-6 text-center">
                {{ content()!.title }}
              </h1>
              <!-- Centered author & metadata -->
              <div class="text-center mb-6">
                <a [routerLink]="content()!.author?.id ? ['/author', content()!.author.id] : null"
                  class="text-base font-medium text-gray-700 hover:text-gray-900 transition-colors duration-200"
                  [class.cursor-pointer]="content()!.author?.id"
                  [class.cursor-default]="!content()!.author?.id">
                  {{ content()!.author?.name || 'Anonymous' | titlecase}}
                </a>
                <div class="text-sm text-gray-500 mt-2">{{ content()!.readingTime }} min read</div>
              </div>
              
              <!-- Description -->
              @if (content()!.description) {
                <div class="mb-6 sm:mb-10">
                  <!-- Center and constrain description width: 85% on mobile, ~60-66% on larger screens -->
                  <div class="mx-auto w-[85%] lg:w-3/5 xl:w-2/3">
                    <p class="text-lg sm:text-xl text-gray-600 leading-relaxed font-light italic font-serif border-l-4 border-gray-300 px-4 sm:px-8 lg:px-12">
                      {{ content()!.description }}
                    </p>
                  </div>
                </div>
              }
            </header>
            <!-- Featured Image - Larger, Full Width -->
            @if (content()!.imageUrl) {
              <div class="mb-6 sm:mb-12 featured-image-wrapper">
                <img [src]="content()!.imageUrl"
                  [alt]="content()!.title"
                  class="w-full max-w-4xl mx-auto object-contain rounded-lg"
                  style="aspect-ratio: 1200/630; max-height: 630px;">
              </div>
            }
            <!-- Content Items -->
            <div class="prose-custom">
              @if (content()!.contents && content()!.contents.length > 0) {
                <div>
                  @for (item of content()!.contents; track item; let i = $index) {
                    <article
                      class="content-section mb-8 sm:mb-16">
                      <!-- Content Title (if multiple items) -->
                      @if (content()!.contents.length > 1) {
                        <h2
                          class="content-title">
                          {{ item.title }}
                        </h2>
                      }
                      <!-- Content Body -->
                      <app-content-renderer
                        class="content-body reading-text"
                        [html]="item.body"
                        [initialFontSize]="fontSize()"
                        [style.line-height]="lineHeight()"
                        [class.compact-spacing]="layoutMode() === 'compact'"
                        [class.spacious-spacing]="layoutMode() === 'spacious'">
                      </app-content-renderer>
                      
                      <!-- Footnotes -->
                      @if (item.footnotes) {
                        <div class="mt-8 pt-6 border-t border-gray-200">
                          <h4 class="text-xs font-medium text-gray-500 mb-3 uppercase tracking-wide">Footnotes</h4>
                          <p class="text-sm text-gray-600 leading-relaxed font-serif italic whitespace-pre-wrap">{{ item.footnotes }}</p>
                        </div>
                      }
                    </article>
                  }
                </div>
              } @else {
                <div class="bg-white border border-gray-200 rounded-lg p-6 sm:p-12 text-center">
                  <div class="w-16 h-16 mx-auto mb-4 bg-white-secondary rounded-full flex items-center justify-center">
                    <svg class="w-8 h-8 text-gray-900-tertiary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                  </div>
                  <h3 class="text-lg font-semibold text-gray-900 mb-2">Content Not Available</h3>
                  <p class="text-gray-900-secondary mb-4">
                    The main content for this submission is currently not available.
                  </p>
                  <button
                    (click)="loadContent(content()!._id)"
                    class="btn-primary">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    Retry Loading
                  </button>
                </div>
              }
              <!-- No Content Message -->
            </div>

            <!-- Reworked Tags, Author Bio, and Sharing Buttons - center aligned -->
            <div class="mt-12 pt-6 border-t border-gray-200">
              <div class="max-w-3xl mx-auto text-center space-y-8 px-4">
                <!-- Tags (centered) -->
                @if (allTags() && allTags().length > 0) {
                  <div class="flex flex-wrap justify-center items-center gap-2">
                    <span class="text-xs font-medium text-gray-500 uppercase tracking-wide">Tags:</span>
                    @for (tag of allTags(); track tag) {
                      <button
                        (click)="onTagClick(tag, $event)"
                        class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-50 text-gray-700 border border-gray-200 hover:bg-gray-100 hover:text-gray-900 transition-colors duration-200 cursor-pointer">
                        #{{ tag }}
                      </button>
                    }
                  </div>
                }

                <!-- Author Bio (centered, constrained width) -->
                @if (content()!.author?.name && content()!.author?.name !== 'Anonymous') {
                  <div class="mx-auto max-w-2xl">
                    <div class="flex flex-col items-center sm:flex-row sm:items-start gap-6 px-4">
                      <!-- Author image (if available) -->
                      @if (authorDetails()?.profileImage) {
                        <div class="flex-shrink-0">
                          <img [src]="authorDetails()?.profileImage" [alt]="'Author profile image'" class="w-24 h-24 rounded-full object-cover border border-gray-200 shadow-sm">
                        </div>
                      }

                      <!-- Author name removed per request - only show bio -->
                      <div class="text-center sm:text-left">
                        @if (authorDetails()?.bio) {
                          <p class="text-gray-700 text-base leading-relaxed font-serif">
                            {{ authorDetails()!.bio }}
                          </p>
                        } @else {
                          <p class="text-gray-500 text-base italic font-serif">
                            @if (authorDetails()) {
                              This author hasn't added a bio yet.
                            } @else {
                              Author profile details are not available.
                            }
                          </p>
                        }
                      </div>
                    </div>
                  </div>
                }

                <!-- Sharing Buttons (centered row, consistent look) -->
                <div class="flex justify-center items-center gap-3">
                  <button
                    (click)="toggleBookmark()"
                    [ngClass]="{
                      'text-gray-900 bg-gray-200 border-gray-300': content()!.isBookmarked,
                      'text-gray-600 bg-gray-100 border-gray-200 hover:text-gray-900 hover:bg-gray-200': !content()!.isBookmarked
                    }"
                    class="flex items-center gap-2 px-4 py-2 border rounded-lg transition-all duration-200 btn-feedback touch-target">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"/>
                    </svg>
                  </button>

                  <!-- Native Share (Mobile) -->
                  @if (canShare()) {
                    <button
                      (click)="shareContent()"
                      class="flex items-center gap-2 px-3 py-2 bg-white border border-gray-200 rounded-lg hover:text-blue-400 hover:border-blue-500/30 transition-all duration-200 btn-feedback touch-target"
                      title="Share">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z" />
                      </svg>
                    </button>
                  }

                  <!-- WhatsApp -->
                  <button
                    (click)="shareOnWhatsApp()"
                    class="flex items-center justify-center bg-white border border-gray-200 rounded-lg p-2 hover:bg-gray-50 text-gray-600 hover:text-green-600 transition-all duration-200 btn-feedback"
                    title="Share on WhatsApp">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.890-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
                    </svg>
                  </button>

                  <!-- Facebook -->
                  <button
                    (click)="shareOnFacebook()"
                    class="flex items-center justify-center bg-white border border-gray-200 rounded-lg p-2 hover:bg-gray-50 text-gray-600 hover:text-blue-600 transition-all duration-200 btn-feedback"
                    title="Share on Facebook">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                    </svg>
                  </button>

                  <!-- Instagram -->
                  <button
                    (click)="shareOnInstagram()"
                    class="flex items-center justify-center bg-white border border-gray-200 rounded-lg p-2 hover:bg-gray-50 text-gray-600 hover:text-purple-600 transition-all duration-200 btn-feedback"
                    title="Share on Instagram">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M12.017 0C8.396 0 7.989.016 6.756.072 5.52.131 4.67.334 3.929.63a5.88 5.88 0 00-2.126 1.384A5.888 5.888 0 00.43 4.14C.135 4.881-.068 5.733.017 6.968.002 8.202.017 8.615.017 12.017s-.015 3.815.072 5.05c.059 1.234.262 2.086.558 2.827a5.895 5.895 0 001.384 2.127 5.868 5.868 0 002.126 1.384c.741.296 1.593.499 2.827.558 1.235.056 1.648.072 5.05.072s3.815-.016 5.05-.072c1.234-.059 2.086-.262 2.827-.558a5.898 5.898 0 002.127-1.384 5.886 5.886 0 001.384-2.127c.296-.741.499-1.593.558-2.827.056-1.235.072-1.648.072-5.05s-.016-3.815-.072-5.05c-.059-1.234-.262-2.086-.558-2.827a5.898 5.898 0 00-1.384-2.127A5.847 5.847 0 0019.778.63c-.741-.296-1.593-.499-2.827-.558C15.812.016 15.399 0 12.017 0zm0 2.162c3.204 0 3.584.012 4.849.07 1.366.062 2.198.336 2.713.558a4.55 4.55 0 011.675 1.09c.5.5.9 1.034 1.09 1.675.222.515.496 1.347.558 2.713.058 1.265.07 1.645.07 4.849s-.012 3.584-.07 4.849c-.062 1.366-.336 2.198-.558 2.713a4.55 4.55 0 01-1.09 1.675c-.5.5-1.034.9-1.675 1.09-.515.222-1.347.496-2.713.558-1.265.058-1.648.072-4.849.072s-3.584-.012-4.849-.07c-1.366-.062-2.198-.336-2.713-.558a4.55 4.55 0 01-1.675-1.09c-.5-.5-.9-1.034-1.09-1.675-.222-.515-.496-1.347-.558-2.713-.058-1.265-.07-1.645-.07-4.849s.012-3.584.07-4.849c.062-1.366.336-2.198.558-2.713a4.55 4.55 0 011.09-1.675c.5-.5 1.034-.9 1.675-1.09.515-.222 1.347-.496 2.713-.558 1.265-.058 1.648-.072 4.849-.072l.028 2.162-.028-2.162zm0 3.676c-3.405 0-6.162 2.76-6.162 6.162 0 3.405 2.76 6.162 6.162 6.162 3.405 0 6.162-2.76 6.162-6.162 0-3.405-2.76-6.162-6.162-6.162zM12.017 16a4 4 0 114-.001 4 4 0 01-4 .001zm7.846-10.405a1.441 1.441 0 01-2.88 0 1.441 1.441 0 012.88 0z"/>
                    </svg>
                  </button>

                </div>

                <!-- Publication date (centered) -->
                <div class="mt-6 text-center text-sm text-gray-500">
                  {{ content()!.publishedAt | date:'MMMM d, y' }}
                </div>

              </div>
            </div>

            <!-- Related Content Section (centered container) -->
            <div class="max-w-3xl mx-auto px-2 sm:px-4 lg:px-6 pb-12">
              <app-related-content
                [currentPostId]="content()!._id"
                [contentType]="content()!.submissionType"
                [currentTags]="content()!.tags"
                [layout]="'bottom'">
              </app-related-content>
            </div>
          </div>
        </div>
      </div>
    </main>
    }

    <!-- Loading State (show when there's no content and no error) -->
    @if (!content() && !error()) {
      <div class="flex items-center justify-center min-h-screen">
        <div class="text-center">
          <div class="w-12 h-12 mx-auto mb-4 border-4 border-primary/20 border-t-primary rounded-full animate-spin"></div>
          <p class="text-gray-900-secondary">Loading content...</p>
        </div>
      </div>
    }

    <!-- Error State (only show when there's no content) -->
    @if (!content() && error()) {
      <div class="flex items-center justify-center min-h-screen">
        <div class="text-center max-w-md mx-auto p-8">
          <div class="w-16 h-16 mx-auto mb-4 bg-red-100 dark:bg-red-900/20 rounded-full flex items-center justify-center">
            <svg class="w-8 h-8 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <h2 class="text-xl font-semibold text-gray-900 mb-2">Failed to Load Content</h2>
          <p class="text-gray-900-secondary mb-4">{{ error() }}</p>
          <button
            (click)="retry()"
            class="btn-primary">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
            Try Again
          </button>
        </div>
      </div>
    }

  </div>
<div class="w-full">
  <!-- Standardized Header -->
  <app-admin-page-header
    title="Prompt Management"
    subtitle="Create, edit, and manage writing prompts"
    [loading]="loading">
    
    <div class="flex items-center gap-2 sm:gap-3">
      <button
        (click)="refreshPrompts()"
        class="btn-secondary flex items-center gap-1 sm:gap-2 text-xs sm:text-sm btn-feedback touch-target"
        [disabled]="loading">
        <svg class="w-3 h-3 sm:w-4 sm:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
        </svg>
        <span class="hidden sm:inline">Refresh</span>
      </button>
      <button
        (click)="createPrompt()"
        class="btn-primary flex items-center gap-1 sm:gap-2 text-xs sm:text-sm btn-feedback touch-target">
        <svg class="w-3 h-3 sm:w-4 sm:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
        <span class="hidden sm:inline">Create Prompt</span>
        <span class="sm:hidden">Create</span>
      </button>
    </div>
  </app-admin-page-header>

  <!-- Create/Edit Form -->
  @if (showCreateForm) {
    <div class="bg-white border border-gray-200 rounded-lg p-6 mb-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold text-gray-900">
          {{ editingPrompt ? 'Edit Prompt' : 'Create New Prompt' }}
        </h3>
        <button
          (click)="cancelEdit()"
          class="text-gray-500 hover:text-gray-700 transition-colors duration-200">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      <form [formGroup]="promptForm" (ngSubmit)="savePrompt()">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <!-- Title -->
          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-gray-700 mb-2">Title *</label>
            <input
              type="text"
              formControlName="title"
              placeholder="Enter prompt title..."
              class="form-input"
              [class.border-red-500]="promptForm.get('title')?.invalid && promptForm.get('title')?.touched" />
            @if (promptForm.get('title')?.invalid && promptForm.get('title')?.touched) {
              <div class="text-red-500 text-sm mt-1">
                Title is required (max 200 characters)
              </div>
            }
          </div>
          <!-- Type -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Type *</label>
            <select
              formControlName="type"
              class="form-input"
              [class.border-red-500]="promptForm.get('type')?.invalid && promptForm.get('type')?.touched">
              <option value="">Select type...</option>
              <option value="poem">Poem</option>
              <option value="prose">Prose</option>
              <option value="article">Article</option>
              <option value="cinema_essay">Cinema Essay</option>
            </select>
          </div>
          <!-- Difficulty -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Difficulty *</label>
            <select formControlName="difficulty" class="form-input">
              <option value="beginner">Beginner</option>
              <option value="intermediate">Intermediate</option>
              <option value="advanced">Advanced</option>
            </select>
          </div>
          <!-- Status Toggles -->
          <div class="md:col-span-2 flex gap-6">
            <label class="flex items-center">
              <input
                type="checkbox"
                formControlName="isActive"
                class="mr-2 rounded border-gray-300 focus:ring-blue-500" />
              <span class="text-gray-700">Active</span>
            </label>
            <label class="flex items-center">
              <input
                type="checkbox"
                formControlName="featured"
                class="mr-2 rounded border-gray-300 focus:ring-blue-500" />
              <span class="text-gray-700">Featured</span>
            </label>
          </div>
        </div>
        <!-- Description -->
        <div class="mb-6">
          <label class="block text-sm font-medium text-gray-700 mb-2">Description *</label>
          <textarea
            formControlName="description"
            rows="4"
            placeholder="Enter the writing prompt description..."
            class="form-input resize-none"
            [class.border-red-500]="promptForm.get('description')?.invalid && promptForm.get('description')?.touched">
          </textarea>
          @if (promptForm.get('description')?.invalid && promptForm.get('description')?.touched) {
            <div class="text-red-500 text-sm mt-1">
              Description is required (max 1000 characters)
            </div>
          }
        </div>
        <!-- Actions -->
        <div class="flex justify-end gap-3">
          <button
            type="button"
            (click)="cancelEdit()"
            class="btn-secondary">
            Cancel
          </button>
          <button
            type="submit"
            [disabled]="promptForm.invalid || isSaving"
            class="btn-primary">
            @if (isSaving) {
              <div class="w-4 h-4 mr-2 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
            }
            {{ editingPrompt ? 'Update' : 'Create' }} Prompt
          </button>
        </div>
      </form>
    </div>
  }

  <!-- Filter Component -->
  <app-simple-submission-filter 
    [availableTypes]="['poem', 'prose', 'article', 'cinema_essay']"
    [showSortOptions]="true"
    [sortField]="'createdAt'"
    (filterChange)="onFilterChange($event)">
  </app-simple-submission-filter>

  <!-- Data Table -->
  <app-data-table
    [columns]="columns"
    [data]="paginatedPrompts"
    [actions]="actions"
    [loading]="loading"
    loadingText="Loading prompts..."
    [selectable]="false"
    [rowClickable]="true"
    [pagination]="paginationConfig"
    itemLabel="prompts"
    [trackByFn]="trackByPromptId"
    [badgeConfig]="badgeConfig"
    (onPageChange)="onTablePageChange($event)"
    (onSort)="onTableSort($event)">
    
    <!-- Custom Cell Template -->
    <ng-template #customCell let-item let-column="column">
      @switch (column.key) {
        @case ('title') {
          <div class="max-w-xs">
            <div class="text-sm font-semibold text-gray-900 mb-1">
              {{ item.title }}
            </div>
            <div class="text-xs text-gray-500 leading-relaxed line-clamp-2">
              {{ item.description }}
            </div>
          </div>
        }
        @case ('type') {
          <span class="tag tag-blue">
            {{ getTypeLabel(item.type) }}
          </span>
        }
        @case ('difficulty') {
          <span class="tag"
            [class.tag-green]="item.difficulty === 'beginner'"
            [class.tag-yellow]="item.difficulty === 'intermediate'"
            [class.tag-red]="item.difficulty === 'advanced'">
            {{ getDifficultyLabel(item.difficulty) }}
          </span>
        }
        @case ('status') {
          <div class="flex items-center gap-2">
            <span class="w-2 h-2 rounded-full"
              [class.bg-green-500]="item.isActive"
              [class.bg-gray-400]="!item.isActive">
            </span>
            <span class="text-sm text-gray-600">
              {{ item.isActive ? 'Active' : 'Inactive' }}
            </span>
            @if (item.featured) {
              <span class="tag tag-yellow text-xs">
                ⭐
              </span>
            }
          </div>
        }
      }
    </ng-template>

    <!-- Mobile Card Template -->
    <ng-template #mobileCard let-prompt let-actions="actions">
      <div class="mb-3">
        <h3 class="font-semibold text-gray-900 mb-1">{{ prompt.title }}</h3>
        <p class="text-xs text-gray-500 mt-1 line-clamp-2">{{ prompt.description }}</p>
      </div>
      
      <!-- Type and Status Info -->
      <div class="flex flex-wrap items-center gap-2 mb-3">
        <span class="tag tag-blue">
          {{ getTypeLabel(prompt.type) }}
        </span>
        <span class="tag"
          [class.tag-green]="prompt.difficulty === 'beginner'"
          [class.tag-yellow]="prompt.difficulty === 'intermediate'"
          [class.tag-red]="prompt.difficulty === 'advanced'">
          {{ getDifficultyLabel(prompt.difficulty) }}
        </span>
        <div class="flex items-center gap-1">
          <span class="w-2 h-2 rounded-full"
            [class.bg-green-500]="prompt.isActive"
            [class.bg-gray-400]="!prompt.isActive">
          </span>
          <span class="text-xs text-gray-600">
            {{ prompt.isActive ? 'Active' : 'Inactive' }}
          </span>
        </div>
        @if (prompt.featured) {
          <span class="tag tag-yellow text-xs">
            ⭐
          </span>
        }
        <span class="text-xs text-gray-500">
          {{ prompt.formattedCreatedAt }}
        </span>
      </div>
      
      <!-- Mobile Action Buttons -->
      <div class="flex flex-wrap gap-2">
        @for (action of actions; track action.label) {
          <button
            (click)="action.handler(prompt)"
            [class]="'flex-1 px-3 py-2 text-xs font-medium rounded btn-feedback touch-target ' + 
              (action.color === 'primary' ? 'text-blue-600 bg-blue-50 border border-blue-200' :
               action.color === 'warning' ? 'text-orange-600 bg-orange-50 border border-amber-200' :
               action.color === 'secondary' ? 'text-gray-600 bg-gray-50 border border-gray-200' :
               action.color === 'danger' ? 'text-red-600 bg-red-50 border border-red-200' :
               'text-gray-600 bg-gray-50 border border-gray-200')">
            {{ action.label }}
          </button>
        }
      </div>
    </ng-template>

    <!-- Empty State Template -->
    <ng-template #emptyState>
      <div class="w-16 h-16 mx-auto bg-gray-50 rounded-full flex items-center justify-center mb-4">
        <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
        </svg>
      </div>
      <h3 class="text-lg font-medium text-gray-900 mb-2">No prompts found</h3>
      <p class="text-gray-500 mb-4">
        {{ currentFilters.search || currentFilters.type ? 'Try adjusting your filters.' : 'No prompts have been created yet.' }}
      </p>
      <button
        (click)="createPrompt()"
        class="btn-primary">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
        Create Prompt
      </button>
    </ng-template>
  </app-data-table>
</div>
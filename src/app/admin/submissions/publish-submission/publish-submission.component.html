<div class="bg-white">
  <!-- Header -->
  <div class="border-b border-gray-200 pb-6 mb-8">
    <div class="max-w-7xl mx-auto px-6">
      <div class="flex items-center gap-4 mb-4">
        <button
          (click)="goBack()"
          class="text-gray-500 hover:text-gray-700 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
        </button>
        <div class="flex-1">
          <h1 class="text-3xl font-serif font-bold text-gray-900 leading-tight">
            Publishing Interface
          </h1>
          <p class="text-gray-600">
            Configure SEO settings and publish your submission.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading -->
  @if (loading) {
    <div class="max-w-7xl mx-auto px-6">
      <div class="text-center py-12">
        <div class="spinner mx-auto"></div>
        <p class="text-gray-600 mt-4">Loading submission...</p>
      </div>
    </div>
  }

  <!-- Main Layout -->
  @if (!loading && submission) {
    <div class="bg-white min-h-screen">
      <div class="max-w-7xl mx-auto px-6">
        <div class="grid grid-cols-12 gap-8 lg:gap-12">
          <!-- Main Content Area (Left Panel) -->
          <main class="col-span-12 lg:col-span-8 xl:col-span-8">
            <!-- Article Header -->
            <header class="mb-8 relative">
              <!-- Title Section -->
              <div class="mb-6">
                <h1 class="text-2xl sm:text-4xl lg:text-5xl font-serif font-bold text-gray-900 leading-tight mb-4">{{ submission?.title }}</h1>
                @if (submission?.description) {
                  <p class="text-lg sm:text-xl text-gray-700 leading-relaxed font-light italic font-serif border-l-4 border-orange-500 pl-4 sm:pl-6">{{ submission?.description }}</p>
                }
              </div>
              
              <!-- Author and Metadata -->
              <div class="flex items-start justify-between mb-4 pb-4 sm:mb-8 sm:pb-8 border-b border-gray-200">
                <div>
                  <div class="text-lg font-medium text-gray-900">
                    <span>by {{ submission?.username }}</span>
                  </div>
                  <div class="text-sm text-gray-600 mt-1">
                    {{ submission?.createdAt | date:'MMMM d, y' }}
                  </div>
                </div>
                <div class="flex flex-col items-end gap-2">
                  <app-badge-label [type]="submission.submissionType"></app-badge-label>
                  @if (submission?.readingTime) {
                    <span class="text-sm text-gray-600">{{ submission?.readingTime }} min read</span>
                  }
                  @if (submission?.contents) {
                    <span class="text-sm text-gray-600">{{ submission?.contents.length }} content item(s)</span>
                  }
                </div>
              </div>
            </header>

            <!-- Basic Information Card -->
            <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm mb-8">
              <h2 class="text-xl font-semibold text-gray-900 mb-6">Basic Information</h2>
              <div class="space-y-6">
                <div>
                  <label class="block text-sm font-medium text-gray-900 mb-2">Title</label>
                  <input
                    [(ngModel)]="submission.title"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-orange-300 focus:border-orange-500"
                    placeholder="Enter submission title">
                </div>
                
                <div>
                  <div class="flex items-center justify-between mb-2">
                    <label class="block text-sm font-medium text-gray-900">Description</label>
                    <button
                      (click)="autoFillDescription()"
                      class="text-xs text-orange-600 hover:text-orange-800 font-medium"
                      title="Auto-fill from content">
                      <svg class="w-3 h-3 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                      </svg>
                      Auto-fill
                    </button>
                  </div>
                  <textarea
                    [(ngModel)]="submission.description"
                    rows="3"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-orange-300 focus:border-orange-500 resize-vertical"
                    placeholder="Enter submission description">
                  </textarea>
                </div>

                <div>
                  <div class="flex items-center justify-between mb-2">
                    <label class="block text-sm font-medium text-gray-900">
                      Excerpt (Preview Text)
                    </label>
                    <button
                      type="button"
                      (click)="autoFillExcerpt()"
                      class="text-xs text-orange-600 hover:text-orange-800 font-medium"
                      title="Auto-fill from content">
                      <svg class="w-3 h-3 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                      </svg>
                      Auto-fill
                    </button>
                  </div>
                  <textarea
                    [(ngModel)]="submission.excerpt"
                    rows="2"
                    maxlength="200"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-orange-300 focus:border-orange-500 resize-vertical"
                    placeholder="Short preview text for content cards (max 200 characters)">
                  </textarea>
                  <div class="flex justify-between text-xs text-gray-500 mt-1">
                    <span>Used in content cards and previews</span>
                    <span>{{ (submission?.excerpt || '').length }}/200</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Profile Approval (if pending) -->
            @if (showProfileApproval) {
              <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm mb-8">
                <h2 class="text-xl font-semibold text-gray-900 mb-6">
                  <span class="flex items-center">
                    <svg class="w-6 h-6 text-orange-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                    </svg>
                    User Profile Approval Required
                  </span>
                </h2>
                <div class="bg-orange-50 border border-orange-200 rounded-lg p-6 mb-6">
                  <p class="text-orange-800 mb-2">
                    <strong>{{ userProfile?.username || 'This user' }}</strong> has submitted profile information that requires your approval.
                  </p>
                  <p class="text-sm text-orange-700">
                    Review and approve the bio and profile picture below to make them live on the user's profile.
                  </p>
                </div>
                <div class="space-y-6">
                  <!-- Bio Approval -->
                  @if (profileApprovalData.tempBio) {
                    <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                      <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-medium text-gray-900">Author Bio</h3>
                        <div class="flex gap-2">
                          <button
                            (click)="editBio()"
                            class="px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
                            <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                            </svg>
                            Edit
                          </button>
                          <button
                            (click)="approveBio()"
                            class="px-3 py-1.5 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 transition-colors">
                            <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            Approve Bio
                          </button>
                        </div>
                      </div>
                      <div class="bg-white border border-gray-200 rounded-lg p-4">
                        <p class="text-gray-900 whitespace-pre-wrap">{{ profileApprovalData.tempBio }}</p>
                      </div>
                      <div class="mt-3 text-xs text-gray-600">
                        <strong>Current bio:</strong> {{ profileApprovalData.approvedBio || 'No bio set' }}
                      </div>
                    </div>
                  }
                  <!-- Profile Image Approval -->
                  @if (profileApprovalData.tempProfileImage) {
                    <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                      <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-medium text-gray-900">Profile Picture</h3>
                        <button
                          (click)="approveProfileImage()"
                          class="px-3 py-1.5 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 transition-colors">
                          <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                          </svg>
                          Approve Image
                        </button>
                      </div>
                      <div class="flex items-start space-x-6">
                        <!-- New Image -->
                        <div class="flex-1">
                          <p class="text-sm font-medium text-gray-900 mb-2">Submitted Image:</p>
                          <div class="w-32 h-32 rounded-lg overflow-hidden border-2 border-gray-200 bg-gray-50">
                            <img
                              [src]="getProfileImageUrl(profileApprovalData.tempProfileImage)"
                              [alt]="userProfile?.username + ' profile picture'"
                              class="w-full h-full object-cover">
                          </div>
                        </div>
                        <!-- Current Image (if any) -->
                        @if (profileApprovalData.approvedImage) {
                          <div class="flex-1">
                            <p class="text-sm font-medium text-gray-900 mb-2">Current Image:</p>
                            <div class="w-32 h-32 rounded-lg overflow-hidden border-2 border-gray-200 bg-gray-50">
                              <img
                                [src]="getProfileImageUrl(userProfile?.profileImage)"
                                [alt]="userProfile?.username + ' current profile picture'"
                                class="w-full h-full object-cover">
                            </div>
                          </div>
                        }
                        @if (!profileApprovalData.approvedImage) {
                          <div class="flex-1">
                            <p class="text-sm font-medium text-gray-900 mb-2">Current Image:</p>
                            <div class="w-32 h-32 rounded-lg border-2 border-dashed border-gray-200 bg-gray-50 flex items-center justify-center">
                              <p class="text-gray-500 text-xs text-center">No image set</p>
                            </div>
                          </div>
                        }
                      </div>
                    </div>
                  }
                </div>
              </div>
            }

            <!-- Content Management Section -->
            <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm mb-8">
              <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-semibold text-gray-900">Content Management</h2>
                <div class="flex gap-2">
                  <button
                    (click)="activeContentTab = 'edit'"
                    [class.bg-orange-100]="activeContentTab === 'edit'"
                    [class.text-orange-800]="activeContentTab === 'edit'"
                    [class.border-orange-300]="activeContentTab === 'edit'"
                    [class.bg-gray-100]="activeContentTab !== 'edit'"
                    [class.text-gray-700]="activeContentTab !== 'edit'"
                    [class.border-gray-300]="activeContentTab !== 'edit'"
                    class="px-3 py-1.5 text-sm font-medium border rounded-md transition-colors">
                    <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                    </svg>
                    Edit Content
                  </button>
                  <button
                    (click)="activeContentTab = 'preview'"
                    [class.bg-orange-100]="activeContentTab === 'preview'"
                    [class.text-orange-800]="activeContentTab === 'preview'"
                    [class.border-orange-300]="activeContentTab === 'preview'"
                    [class.bg-gray-100]="activeContentTab !== 'preview'"
                    [class.text-gray-700]="activeContentTab !== 'preview'"
                    [class.border-gray-300]="activeContentTab !== 'preview'"
                    class="px-3 py-1.5 text-sm font-medium border rounded-md transition-colors">
                    <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                    </svg>
                    Preview
                  </button>
                </div>
              </div>

              <!-- Content Editing Tab -->
              @if (activeContentTab === 'edit') {
                @if (submission.contents && submission.contents.length > 0) {
                  <div class="space-y-4">
                    @for (content of submission.contents; track content; let i = $index) {
                      <div class="bg-gray-50 rounded-lg border border-gray-200 overflow-hidden">
                        <!-- Content Header -->
                        <div class="flex items-center justify-between p-4 cursor-pointer" (click)="toggleContentExpanded(i)">
                          <div class="flex-1">
                            <h3 class="font-medium text-gray-900">
                              {{ i + 1 }}. {{ content.title || 'Untitled Content' }}
                            </h3>
                            <p class="text-sm text-gray-600 mt-1">
                              {{ calculateWordCount(content.body) }} words
                              @if (content.tags && content.tags.length > 0) {
                                <span> • {{ content.tags.length }} tag(s)</span>
                              }
                            </p>
                          </div>
                          <div class="flex items-center gap-2">
                            @if (submission.contents.length > 1) {
                              <button
                                (click)="deleteContent(i); $event.stopPropagation()"
                                class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                                title="Delete this content section">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                              </button>
                            }
                            <svg class="w-5 h-5 text-gray-500 transition-transform duration-200"
                              [class.rotate-180]="contentExpanded[i]"
                              fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                          </div>
                        </div>
                        
                        <!-- Expanded Content -->
                        @if (contentExpanded[i]) {
                          <div class="px-4 pb-4 border-t border-gray-200">
                            <div class="space-y-4 mt-4">
                              <!-- Content Title -->
                              <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">Content Title</label>
                                <input
                                  [(ngModel)]="content.title"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-orange-300 focus:border-orange-500"
                                  placeholder="Enter content title">
                              </div>
                              <!-- Content Body -->
                              <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">Content Body</label>
                                <app-rich-text-editor
                                  [(ngModel)]="content.body"
                                  [placeholder]="'Enter your content here...'"
                                  [allowImages]="false"
                                  class="min-h-64">
                                </app-rich-text-editor>
                                <div class="flex justify-between text-xs text-gray-500 mt-2">
                                  <span>Use formatting tools above for better presentation</span>
                                  <span>{{ calculateWordCount(content.body) }} words</span>
                                </div>
                              </div>
                              <!-- Content Footnotes -->
                              <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">Footnotes (Optional)</label>
                                <textarea
                                  [(ngModel)]="content.footnotes"
                                  rows="3"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-orange-300 focus:border-orange-500 resize-vertical"
                                  placeholder="Optional: Add footnotes to explain cultural references, colloquial words, or regional terms in this content.">
                                </textarea>
                                <div class="text-xs text-gray-500 mt-1">
                                  Optional: Add footnotes to explain cultural references, colloquial words, or regional terms in this content.
                                </div>
                              </div>
                              <!-- Content Tags -->
                              <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">Content Tags</label>
                                <app-tag-input
                                  [(ngModel)]="content.tags"
                                  [placeholder]="'Add topics like love poetry, urban life'"
                                  [helperText]="'Add relevant topics for this content. These help categorize and make content discoverable.'"
                                  [maxTags]="10"
                                  [minTagLength]="2"
                                  [maxTagLength]="50">
                                </app-tag-input>
                              </div>
                            </div>
                          </div>
                        }
                      </div>
                    }
                  </div>
                  
                  <div class="mt-4 text-center">
                    <button
                      (click)="addNewContent()"
                      [disabled]="submission?.submissionType !== 'poem'"
                      [class.opacity-50]="submission?.submissionType !== 'poem'"
                      [class.cursor-not-allowed]="submission?.submissionType !== 'poem'"
                      class="px-4 py-2 text-sm font-medium text-orange-700 bg-orange-50 border border-orange-200 rounded-md hover:bg-orange-100 transition-colors disabled:hover:bg-orange-50">
                      <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                      </svg>
                      Add Content Section
                    </button>
                    @if (submission?.submissionType !== 'poem') {
                      <p class="text-sm text-gray-500 mt-2">Additional content sections can only be added to poems.</p>
                    }
                  </div>
                }
                @if (!submission.contents || submission.contents.length === 0) {
                  <div class="text-center py-12">
                    <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">No content sections</h3>
                    <p class="text-gray-600 mb-6">This submission doesn't have any content sections yet.</p>
                    <button
                      (click)="addNewContent()"
                      [disabled]="submission?.submissionType !== 'poem'"
                      [class.opacity-50]="submission?.submissionType !== 'poem'"
                      [class.cursor-not-allowed]="submission?.submissionType !== 'poem'"
                      class="px-4 py-2 text-sm font-medium text-white bg-orange-600 rounded-md hover:bg-orange-700 transition-colors disabled:bg-orange-600 disabled:hover:bg-orange-600">
                      <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                      </svg>
                      Add First Content Section
                    </button>
                    @if (submission?.submissionType !== 'poem') {
                      <p class="text-sm text-gray-500 mt-2">Content sections can only be added to poems.</p>
                    }
                  </div>
                }
              }
              
              <!-- Preview Mode Tab -->
              @if (activeContentTab === 'preview') {
                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                  <!-- Article Header -->
                  <div class="p-6 border-b border-gray-200">
                    <h1 class="text-3xl font-bold text-gray-900 mb-4">{{ submission.title }}</h1>
                    <div class="flex items-center gap-4 text-sm text-gray-600 mb-4">
                      <span>By {{ submission.username }}</span>
                      <app-badge-label [type]="submission.submissionType"></app-badge-label>
                      @if (submission.readingTime) {
                        <span>{{ submission.readingTime }} min read</span>
                      }
                    </div>
                    @if (submission?.description) {
                      <p class="text-gray-600 italic">{{ submission?.description }}</p>
                    }
                  </div>
                  
                  <!-- Article Content -->
                  <div class="p-6 space-y-8">
                    @for (content of submission.contents; track content; let i = $index) {
                      <div class="content-section">
                        @if (content.title) {
                          <h2 class="text-2xl font-semibold text-gray-900 mb-4">{{ content.title }}</h2>
                        }
                        <div class="content-body prose prose-lg max-w-none" [innerHTML]="cleanContent(content.body)"></div>
                        <!-- Footnotes -->
                        @if (content.footnotes) {
                          <div class="mt-4 p-3 bg-gray-50 rounded-lg border-l-4 border-blue-200">
                            <h4 class="text-sm font-medium text-gray-900 mb-2">Footnotes:</h4>
                            <p class="text-sm text-gray-700 whitespace-pre-wrap">{{ content.footnotes }}</p>
                          </div>
                        }
                        <!-- Tags -->
                        @if (content.tags && content.tags.length > 0) {
                          <div class="flex flex-wrap gap-2 mt-4 pt-4 border-t border-gray-200">
                            <span class="text-sm text-gray-600 mr-2">Topics:</span>
                            @for (tag of content.tags; track tag) {
                              <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-orange-100 text-orange-800 border border-orange-200">
                                {{ tag }}
                              </span>
                            }
                          </div>
                        }
                      </div>
                    }
                  </div>
                </div>
              }
            </div>
          </main>
          
          <!-- Right Panel: Actions and Settings -->
          <aside class="col-span-12 lg:col-span-4 xl:col-span-4">
            <div class="sticky top-6 space-y-6">
              
              <!-- Back Button Panel -->
              <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                <button (click)="goBack()"
                  class="w-full px-4 py-2 text-sm text-gray-700 bg-gray-100 border border-gray-200 rounded-lg hover:bg-gray-200 transition-colors font-medium flex items-center justify-center gap-2">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                  </svg>
                  Back to Admin
                </button>
              </div>
              
              <!-- Publication Actions Panel -->
              <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                <h3 class="text-lg font-semibold text-gray-900 mb-4 text-center">Publication Actions</h3>
                
                <!-- Action Buttons -->
                <div class="space-y-3 mb-6">
                  <button
                    (click)="saveChanges()"
                    class="w-full px-4 py-3 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-200 rounded-lg hover:bg-gray-200 transition-colors flex items-center justify-center gap-2">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M7.707 10.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 12.586V5a1 1 0 10-2 0v7.586l-1.293-1.293z"/>
                    </svg>
                    Save Changes
                  </button>
                  
                  <button
                    (click)="saveAndPublish()"
                    [disabled]="!isFormValid() || isPublishing"
                    class="w-full px-4 py-3 text-sm font-medium text-white bg-orange-600 rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                    @if (!isPublishing) {
                      <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.293l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414z" clip-rule="evenodd"/>
                      </svg>
                      {{ getPublishButtonText() }}
                    }
                    @if (isPublishing) {
                      <div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                      {{ getPublishingText() }}
                    }
                  </button>
                </div>
              </div>
              
              <!-- SEO Settings Panel -->
              <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">SEO Settings</h3>
                <div class="space-y-4">
                  <!-- SEO Slug -->
                  <div>
                    <label class="block text-sm font-medium text-gray-900 mb-2">
                      SEO Slug <span class="text-red-600">*</span>
                    </label>
                    <div class="flex items-center gap-2 mb-2">
                      <span class="text-gray-600 text-sm">{{ baseUrl }}</span>
                      <input
                        [(ngModel)]="seoConfig.slug"
                        (input)="validateSlug()"
                        placeholder="three-poems-by-vinita-agrawal"
                        class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-orange-300 focus:border-orange-500"
                        [class.border-red-300]="slugError">
                    </div>
                    <p class="text-xs text-gray-500 mb-2">
                      This will be the URL path for your published content. Use lowercase letters, numbers, and hyphens only.
                    </p>
                    @if (slugError) {
                      <div class="text-red-600 text-sm">{{ slugError }}</div>
                    }
                    @if (!slugError && seoConfig.slug) {
                      <div class="text-green-600 text-sm">
                        ✓ URL will be: {{ baseUrl }}{{ seoConfig.slug }}
                      </div>
                    }
                  </div>
                  
                  <!-- Meta Title -->
                  <div>
                    <label class="block text-sm font-medium text-gray-900 mb-2">
                      Meta Title <span class="text-red-600">*</span>
                    </label>
                    <input
                      [(ngModel)]="seoConfig.metaTitle"
                      [placeholder]="submission.title"
                      maxlength="60"
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-orange-300 focus:border-orange-500">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                      <span>Recommended: 50-60 characters for optimal SEO</span>
                      <span>{{ seoConfig.metaTitle.length }}/60</span>
                    </div>
                  </div>
                  
                  <!-- Meta Description -->
                  <div>
                    <div class="flex items-center justify-between mb-2">
                      <label class="block text-sm font-medium text-gray-900">
                        Meta Description <span class="text-red-600">*</span>
                      </label>
                      <button
                        (click)="autoFillMetaDescription()"
                        class="text-xs text-orange-600 hover:text-orange-800 font-medium"
                        title="Auto-fill from content">
                        <svg class="w-3 h-3 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                        Auto-fill
                      </button>
                    </div>
                    <textarea
                      [(ngModel)]="seoConfig.metaDescription"
                      [placeholder]="submission?.description || 'A compelling description of your content...'"
                      maxlength="160"
                      rows="3"
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-orange-300 focus:border-orange-500 resize-vertical">
                    </textarea>
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                      <span>Recommended: 150-160 characters for optimal SEO</span>
                      <span>{{ seoConfig.metaDescription.length }}/160</span>
                    </div>
                  </div>
                  
                  <!-- Keywords -->
                  <div>
                    <div class="flex items-center justify-between mb-2">
                      <label class="block text-sm font-medium text-gray-900">
                        SEO Keywords
                      </label>
                      <button
                        (click)="syncSEOKeywordsWithContentTags()"
                        class="text-xs text-orange-600 hover:text-orange-800 font-medium"
                        title="Sync with content tags">
                        <svg class="w-3 h-3 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                        Sync with Tags
                      </button>
                    </div>
                    <input
                      [(ngModel)]="keywordsInput"
                      (keydown.enter)="addKeywordFromInput($event)"
                      (keydown.comma)="addKeywordFromInput($event)"
                      (input)="updateKeywords()"
                      placeholder="Type keyword and press Enter or comma"
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-orange-300 focus:border-orange-500">
                    <p class="text-xs text-gray-500 mt-1">
                      Type keywords and press Enter or comma to add. Click "Sync with Tags" to auto-populate from content tags.
                    </p>
                    @if (seoConfig.keywords.length > 0) {
                      <div class="flex flex-wrap gap-2 mt-2">
                        @for (keyword of seoConfig.keywords; track keyword; let i = $index) {
                          <span class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-blue-100 text-blue-800 border border-blue-200">
                            {{ keyword }}
                            <button
                              type="button"
                              (click)="removeKeyword(i)"
                              class="ml-1 text-blue-600 hover:text-blue-800">
                              <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                              </svg>
                            </button>
                          </span>
                        }
                      </div>
                    }
                  </div>
                </div>
              </div>
              
              <!-- Cover Image Panel -->
              <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Cover Image</h3>
                <p class="text-sm text-gray-600 mb-4">
                  The main image that will appear at the top of your article. Recommended size: 1200x800px.
                </p>
                
                <!-- File Upload for Cover Image -->
                @if (!submission.imageUrl) {
                  <div class="mb-4">
                    <input
                      type="file"
                      accept="image/*"
                      data-type="cover"
                      (change)="onCoverImageSelect($event)"
                      class="block w-full text-sm text-gray-900 bg-gray-50 border border-gray-200 rounded-lg cursor-pointer focus:outline-none file:mr-4 file:py-2 file:px-4 file:rounded-l-lg file:border-0 file:text-sm file:font-medium file:bg-orange-600 file:text-white hover:file:bg-orange-700">
                    <p class="text-xs text-gray-500 mt-1">Upload cover image (max 5MB)</p>
                  </div>
                }
                
                <!-- Upload Button for Cover Image -->
                @if (selectedCoverImageFile && !submission.imageUrl) {
                  <button
                    (click)="uploadCoverImage()"
                    [disabled]="isUploadingCoverImage"
                    class="w-full px-4 py-2 text-sm font-medium text-white bg-orange-600 rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed mb-4">
                    @if (!isUploadingCoverImage) {
                      <span class="flex items-center justify-center gap-2">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                        </svg>
                        Upload Cover Image
                      </span>
                    }
                    @if (isUploadingCoverImage) {
                      <span class="flex items-center justify-center gap-2">
                        <div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                        Uploading...
                      </span>
                    }
                  </button>
                }
                
                <!-- Current Cover Image Preview -->
                @if (submission.imageUrl) {
                  <div>
                    <p class="text-sm font-medium text-gray-900 mb-2">Current Cover Image:</p>
                    <div class="relative w-full">
                      <img
                        [src]="submission.imageUrl"
                        [alt]="submission.title"
                        class="w-full h-32 object-cover rounded-lg border border-gray-200">
                      <button
                        (click)="removeCoverImage()"
                        class="absolute top-2 right-2 p-1 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors"
                        title="Remove cover image (will delete from S3)">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                      </button>
                    </div>
                    <!-- Action buttons for cover image -->
                    <div class="mt-3">
                      <button
                        (click)="useCoverImageAsSocial()"
                        class="w-full px-3 py-1.5 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-200 rounded-md hover:bg-gray-200 transition-colors">
                        <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"/>
                        </svg>
                        Use as Social Media Image
                      </button>
                    </div>
                  </div>
                }
              </div>
              
              <!-- Social Media Image Panel -->
              <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Social Media Image</h3>
                <p class="text-sm text-gray-600 mb-4">
                  This image will appear when your content is shared on social media platforms. Recommended size: 1200x630px.
                </p>
                
                <!-- File Upload for Social Media Image -->
                <div class="mb-4">
                  <input
                    type="file"
                    accept="image/*"
                    data-type="social"
                    (change)="onSocialImageSelect($event)"
                    class="block w-full text-sm text-gray-900 bg-gray-50 border border-gray-200 rounded-lg cursor-pointer focus:outline-none file:mr-4 file:py-2 file:px-4 file:rounded-l-lg file:border-0 file:text-sm file:font-medium file:bg-orange-600 file:text-white hover:file:bg-orange-700">
                  <p class="text-xs text-gray-500 mt-1">Upload social media image (max 5MB)</p>
                </div>
                
                <!-- Upload Button for Social Media Image -->
                @if (selectedSocialImageFile) {
                  <button
                    (click)="uploadSocialImage()"
                    [disabled]="isUploadingSocialImage"
                    class="w-full px-4 py-2 text-sm font-medium text-white bg-orange-600 rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed mb-4">
                    @if (!isUploadingSocialImage) {
                      <span class="flex items-center justify-center gap-2">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                        </svg>
                        Upload Social Image
                      </span>
                    }
                    @if (isUploadingSocialImage) {
                      <span class="flex items-center justify-center gap-2">
                        <div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                        Uploading...
                      </span>
                    }
                  </button>
                }
                
                <!-- Current Social Media Image Preview -->
                @if (seoConfig.ogImage) {
                  <div>
                    <p class="text-sm font-medium text-gray-900 mb-2">Current Social Media Image:</p>
                    <div class="relative w-full">
                      <img
                        [src]="seoConfig.ogImage"
                        [alt]="submission.title + ' social media image'"
                        class="w-full h-32 object-cover rounded-lg border border-gray-200">
                      <button
                        (click)="removeSocialImage()"
                        class="absolute top-2 right-2 p-1 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors"
                        title="Remove social media image">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                      </button>
                    </div>
                    <!-- Action buttons for social media image -->
                    <div class="mt-3">
                      <button
                        (click)="useSocialImageAsCover()"
                        class="w-full px-3 py-1.5 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-200 rounded-md hover:bg-gray-200 transition-colors">
                        <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        Use as Cover Image
                      </button>
                    </div>
                  </div>
                }
                
                <!-- Quick Actions -->
                @if (submission.imageUrl && !seoConfig.ogImage) {
                  <div class="mt-4 p-3 bg-gray-50 rounded-lg">
                    <p class="text-sm font-medium text-gray-900 mb-2">Quick Actions:</p>
                    <button
                      (click)="useCoverImageAsSocial()"
                      class="px-3 py-1.5 text-xs font-medium text-orange-700 bg-orange-50 border border-orange-200 rounded-md hover:bg-orange-100 transition-colors">
                      Copy from Cover Image
                    </button>
                  </div>
                }
                @if (!submission.imageUrl && !seoConfig.ogImage) {
                  <div class="mt-4 p-3 bg-gray-50 rounded-lg">
                    <p class="text-xs text-gray-500 text-center">
                      Upload a cover image or social media image to enable quick actions
                    </p>
                  </div>
                }
              </div>
              
              <!-- Publication Settings Panel -->
              <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Publication Settings</h3>
                <div class="space-y-3">
                  <label class="flex items-center">
                    <input
                      type="checkbox"
                      [(ngModel)]="seoConfig.featuredPost"
                      class="w-4 h-4 text-orange-600 bg-gray-100 border-gray-300 rounded focus:ring-orange-500 focus:ring-2">
                    <span class="ml-3 text-gray-900 text-sm">Mark as featured post</span>
                  </label>
                </div>
              </div>
              
              <!-- SEO Preview Panel -->
              <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">SEO Preview</h3>
                
                <!-- Google Search Preview -->
                <div class="bg-gray-50 p-4 rounded-lg mb-4">
                  <div class="text-blue-600 text-lg hover:underline cursor-pointer">
                    {{ seoConfig.metaTitle || submission.title }}
                  </div>
                  <div class="text-green-600 text-sm">
                    {{ baseUrl }}{{ seoConfig.slug || 'your-seo-slug' }}
                  </div>
                  <div class="text-gray-600 text-sm mt-1">
                    {{ seoConfig.metaDescription || submission?.description || 'Meta description will appear here...' }}
                  </div>
                </div>
                
                <!-- Social Media Preview -->
                <div class="bg-gray-50 p-4 rounded-lg">
                  <div class="text-sm text-gray-600 mb-2">Social Media Preview:</div>
                  <div class="bg-white shadow-sm rounded-lg overflow-hidden max-w-sm">
                    @if (seoConfig.ogImage || submission.imageUrl) {
                      <div class="h-32 bg-gray-100">
                        <img [src]="seoConfig.ogImage || submission.imageUrl" [alt]="submission.title" class="w-full h-full object-cover">
                      </div>
                    }
                    @if (!seoConfig.ogImage && !submission.imageUrl) {
                      <div class="h-32 bg-gray-100 flex items-center justify-center">
                        <span class="text-gray-500 text-sm">No image set</span>
                      </div>
                    }
                    <div class="p-3">
                      <div class="font-medium text-sm">{{ seoConfig.metaTitle || submission.title }}</div>
                      <div class="text-gray-600 text-xs mt-1">
                        {{ (seoConfig.metaDescription || submission?.description || 'Description...') | slice:0:100 }}{{ (seoConfig.metaDescription || submission?.description || '').length > 100 ? '...' : '' }}
                      </div>
                      <div class="text-gray-500 text-xs mt-1">{{ baseUrl }}</div>
                    </div>
                  </div>
                  <p class="text-xs text-gray-500 mt-2">
                    <strong>Image priority:</strong> Social Media Image → Cover Image → No image
                  </p>
                </div>
              </div>
            </div>
          </aside>
        </div>
      </div>
    </div>
  }

  <!-- Error State -->
  @if (!loading && !submission) {
    <div class="max-w-7xl mx-auto px-6">
      <div class="text-center py-12">
        <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 18.5c-.77.833.192 2.5 1.732 2.5z"/>
        </svg>
        <h3 class="text-lg font-medium text-gray-900 mb-2">Submission not found</h3>
        <p class="text-gray-600">The submission you're trying to publish could not be found.</p>
      </div>
    </div>
  }

  <!-- Toast Notification -->
  @if (showToastFlag) {
    <div class="fixed top-4 right-4 z-50 max-w-sm w-full transition-all duration-300 ease-in-out transform">
      <div class="bg-white border border-gray-200 rounded-lg shadow-lg p-4"
       [ngClass]="{
         'border-green-200 bg-green-50': toastType === 'success',
         'border-red-200 bg-red-50': toastType === 'error',
         'border-blue-200 bg-blue-50': toastType === 'info'
       }">
        <div class="flex items-start">
          <div class="flex-shrink-0">
            <!-- Success Icon -->
            @if (toastType === 'success') {
              <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            }
            <!-- Error Icon -->
            @if (toastType === 'error') {
              <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            }
            <!-- Info Icon -->
            @if (toastType === 'info') {
              <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            }
          </div>
          <div class="ml-3 flex-1">
            <p class="text-sm font-medium"
           [ngClass]="{
             'text-green-800': toastType === 'success',
             'text-red-800': toastType === 'error',
             'text-blue-800': toastType === 'info'
           }">
              {{ toastMessage }}
            </p>
          </div>
          <div class="ml-4 flex-shrink-0">
            <button
              (click)="hideToast()"
              class="inline-flex text-gray-400 hover:text-gray-600 focus:outline-none transition ease-in-out duration-150">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  }
</div>
<div class="submit-form-container">
  <!-- Progress Steps (Create mode only - Mobile) -->
  @if (isCreateMode) {
  <div class="lg:hidden px-6 py-4 bg-white-tertiary">
    <div class="flex items-center justify-center space-x-2">
      <div class="flex items-center space-x-2">
        <div [class]="getCurrentStep() >= 1 ? 'w-2 h-2 rounded-full' : 'w-2 h-2 rounded-full'"
          [style.background-color]="getCurrentStep() >= 1 ? 'var(--bg-accent)' : 'var(--border-primary)'"></div>
        <div [class]="getCurrentStep() >= 2 ? 'w-8 h-0.5' : 'w-8 h-0.5'"
          [style.background-color]="getCurrentStep() >= 2 ? 'var(--bg-accent)' : 'var(--border-primary)'"></div>
        <div [class]="getCurrentStep() >= 2 ? 'w-2 h-2 rounded-full' : 'w-2 h-2 rounded-full'"
          [style.background-color]="getCurrentStep() >= 2 ? 'var(--bg-accent)' : 'var(--border-primary)'"></div>
        <div [class]="getCurrentStep() >= 3 ? 'w-8 h-0.5' : 'w-8 h-0.5'"
          [style.background-color]="getCurrentStep() >= 3 ? 'var(--bg-accent)' : 'var(--border-primary)'"></div>
        <div [class]="getCurrentStep() >= 3 ? 'w-2 h-2 rounded-full' : 'w-2 h-2 rounded-full'"
          [style.background-color]="getCurrentStep() >= 3 ? 'var(--bg-accent)' : 'var(--border-primary)'"></div>
      </div>
    </div>
    <p class="text-xs text-center text-gray-900-tertiary mt-2">{{ getCurrentStepText() }}</p>
  </div>
  }

  <!-- Form Content -->
  <div class="px-6 py-6 pb-32 lg:pb-0">
    @if (form) {
    <form [formGroup]="form" (ngSubmit)="isCreateMode ? submitForm() : submitForReview()"
      class="space-y-8 lg:space-y-12">

      <!-- Step 1: Type Selection -->
      @if (isCreateMode) {
      <fieldset class="space-y-4 lg:space-y-6">
        <legend class="text-lg lg:text-2xl text-gray-900 font-medium lg:text-center">What would you like to share?
        </legend>
        <!-- Mobile Grid -->
        <div class="space-y-3 lg:hidden" role="radiogroup">
          @for (type of submissionTypes; track type) {
          <label class="block" [for]="'submission-type-' + type.value">
            <input type="radio" [id]="'submission-type-' + type.value" name="submissionType" [value]="type.value"
              [checked]="selectedType === type.value" (change)="onTypeSelected(type.value)" class="sr-only" />
            <div class="p-4 rounded-lg border transition-all duration-200 cursor-pointer" [class]="selectedType === type.value ?
                             'border-themed-accent bg-themed-accent-light shadow-md' :
                             'border-gray-200 bg-white hover:bg-themed-hover hover:border-gray-300'" role="radio"
              [attr.aria-checked]="selectedType === type.value">
              <div class="flex items-center space-x-3">
                <div class="w-8 h-8 flex items-center justify-center"
                  [class]="selectedType === type.value ? 'text-themed-accent' : 'text-gray-600'">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                      [attr.d]="getIconForType(type.value)"></path>
                  </svg>
                </div>
                <div class="flex-1">
                  <div class="font-medium text-gray-900">
                    {{ type.label }}
                    @if (type.fastTrack) {
                    <span class="ml-2 text-xs text-themed-accent font-medium">Quick Review & Publishing</span>
                    }
                  </div>
                  <div class="text-sm text-gray-600">{{ type.description }}</div>
                </div>
                @if (selectedType === type.value) {
                <div class="w-5 h-5 text-gray-900-accent">
                  <svg fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd"
                      d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                      clip-rule="evenodd" />
                  </svg>
                </div>
                }
              </div>
            </div>
          </label>
          }
        </div>
        <!-- Desktop Grid -->
        <div class="hidden lg:grid grid-cols-2 gap-6">
          @for (type of submissionTypes; track type) {
          <label class="block cursor-pointer group">
            <input type="radio" name="submissionType" [value]="type.value" [checked]="selectedType === type.value"
              (change)="onTypeSelected(type.value)" class="sr-only" />
            <div
              class="p-6 rounded-xl border transition-all duration-200 text-center h-full flex flex-col justify-center"
              [class]="selectedType === type.value ? 'border-themed-accent bg-themed-accent-light shadow-lg' : 'border-gray-200 bg-white hover:bg-themed-hover hover:border-gray-300'">
              <div class="w-12 h-12 mx-auto mb-4 flex items-center justify-center"
                [class]="selectedType === type.value ? 'text-themed-accent' : 'text-gray-600'">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                    [attr.d]="getIconForType(type.value)"></path>
                </svg>
              </div>
              <div class="text-lg font-semibold text-gray-900 mb-2">{{ type.label }}</div>
              <div class="text-sm text-gray-600 mb-1">{{ type.description }}</div>
              @if (type.fastTrack) {
              <div class="text-xs text-themed-accent font-medium">Quick Review & Publishing</div>
              }
            </div>
          </label>
          }
        </div>
      </fieldset>
      }

      <!-- Type Display for Edit/Resubmit modes (Locked) -->
      @if (!isCreateMode && selectedType) {
      <div class="space-y-4 lg:space-y-6">
        <h2 class="text-lg lg:text-xl text-gray-900 lg:text-center">{{ isResubmitMode ? 'Resubmitting' : 'Editing' }}:
          {{ getTypeDisplayName() }}</h2>
        <div class="lg:flex lg:justify-center">
          @for (type of submissionTypes; track type) {
          @if (selectedType === type.value) {
          <div class="block lg:max-w-sm">
            <div class="p-4 lg:p-6 rounded-2xl border bg-gray-50 border-gray-300 opacity-75 lg:text-center">
              <div class="flex lg:flex-col items-center lg:justify-center space-x-4 lg:space-x-0">
                <div
                  class="w-10 h-10 lg:w-12 lg:h-12 rounded-full flex items-center justify-center text-sm lg:text-lg font-medium bg-gray-200 text-gray-600 lg:mx-auto lg:mb-4"
                  [innerHTML]="type.icon">
                </div>
                <div class="flex-1 lg:flex-none">
                  <div class="font-medium lg:font-semibold text-gray-700 lg:mb-2">{{ type.label }}</div>
                  <div class="text-sm text-gray-500 lg:mb-3">{{ type.description }}</div>
                </div>
                <div class="w-5 h-5 lg:w-6 lg:h-6 text-gray-400 lg:mx-auto">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                  </svg>
                </div>
              </div>
            </div>
            <p class="text-xs text-gray-500 mt-2 lg:text-center">Content type is locked and cannot be changed during
              editing</p>
          </div>
          }
          }
        </div>
      </div>
      }

      <!-- Step 2: Writing -->
      @if (selectedType) {
      <div class="space-y-4 lg:space-y-8" data-section="content">
        <h2 class="text-lg lg:text-xl font-medium lg:font-semibold text-gray-900 lg:text-center">Your {{
          selectedType.replace('_', ' ') }}</h2>
        <div
          [class]="isCreateMode ? 'bg-white px-1 py-4 lg:bg-white lg:border lg:border-gray-200 lg:rounded-2xl lg:p-8 lg:shadow-sm' : 'bg-white border border-gray-200 rounded-2xl p-6 lg:p-8 lg:shadow-sm'">
          <!-- Title Field for Edit/Resubmit modes -->
          @if (!isCreateMode) {
          <div class="mb-6 lg:mb-8">
            <input type="text" formControlName="title"
              class="w-full px-0 py-0 lg:py-4 border-0 bg-white text-gray-900 focus:outline-none focus:ring-0 text-lg lg:text-2xl font-medium lg:font-bold"
              [style.color]="'var(--text-primary)'" placeholder="Give your work a title..."
              [class.border-red-300]="form.get('title')?.invalid && form.get('title')?.touched" [readonly]="isViewMode">
            @if (form.get('title')?.invalid && form.get('title')?.touched) {
            <div class="text-red-500 text-xs lg:text-sm mt-1 lg:mt-2">
              Title is required (3-100 characters)
            </div>
            }
          </div>
          }
          <!-- Content Editor -->
          <app-content-editor [selectedType]="selectedType" [contents]="getContentControls()"
            [formArray]="getContentsFormArray()" [readonly]="isViewMode"
            (contentsChanged)="onContentChanged($event)"></app-content-editor>
        </div>
      </div>
      }

      <!-- Step 3: Final Details -->
      @if (selectedType && hasContent()) {
      <div class="space-y-4 lg:space-y-6">
        <h2 class="text-lg lg:text-xl font-medium lg:font-semibold text-gray-900 lg:text-center">Add context (optional)
        </h2>
        <div
          [class]="isCreateMode ? 'bg-white px-1 py-4 lg:bg-white lg:border lg:border-gray-200 lg:rounded-2xl lg:p-8' : 'bg-white border border-gray-200 rounded-2xl p-6 lg:p-8'">
          <textarea formControlName="description" rows="3"
            class="w-full px-0 py-0 border-0 bg-white text-gray-900 focus:outline-none focus:ring-0 resize-none leading-relaxed lg:text-lg lg:rows-4"
            [style.color]="'var(--text-primary)'"
            [placeholder]="isCreateMode ? 'What inspired this piece? Share the story behind your creation...' : 'What inspired this revision? Share any context about the changes...'"
            [readonly]="isViewMode"></textarea>
        </div>

        <!-- Stats & Actions -->
        <div [class]="isCreateMode ? 'lg:flex lg:items-center lg:justify-between' : 'text-center py-4 lg:py-8'">
          <!-- Word Count -->
          <div class="text-center py-2 lg:py-0">
            <div
              [class]="isCreateMode ? 'text-2xl lg:text-3xl font-light text-gray-900' : 'text-2xl lg:text-4xl font-light text-gray-900 lg:mb-2'">
              {{ getTotalWordCount() }}</div>
            <div [class]="isCreateMode ? 'text-sm text-gray-900-secondary' : 'text-sm text-gray-600 lg:mb-1'">words
            </div>
            @if (isCreateMode) {
            <div class="text-xs text-gray-900-tertiary mt-1 lg:hidden">~{{ Math.ceil(getTotalWordCount() / 200) }} min
              read</div>
            }
            @if (!isCreateMode) {
            <div class="text-sm text-gray-500">~{{ Math.ceil(getTotalWordCount() / 200) }} min read</div>
            }
          </div>

          <!-- Submit Actions -->
          @if (!isViewMode) {
          <div
            [class]="isCreateMode ? 'space-y-4 mt-4 lg:mt-0 lg:flex lg:space-y-0 lg:space-x-4' : 'flex flex-col sm:flex-row justify-center gap-4 lg:gap-6 mt-4 lg:mt-8'">

            <!-- Create Mode Actions -->
            @if (isCreateMode) {
            <!-- Save Draft Button -->


            <!-- Submit Button -->
            <app-button variant="primary" type="submit" [loading]="isSubmitting" [disabled]="!validateForm()">
              {{ isSubmitting ? 'Submitting...' : 'Submit for Review' }}
            </app-button>
            <app-button variant="secondary" type="button" [loading]="isSavingDraft" [disabled]="!hasContent()"
              (click)="saveAsDraft()">
              {{ isSavingDraft ? 'Saving...' : 'Save Draft' }}
            </app-button>

            }

            <!-- Edit/Resubmit Mode Actions -->
            @if (!isCreateMode) {
            @if (isEditMode) {
            <button type="button" (click)="saveChanges()" [disabled]="isSaving"
              class="px-6 lg:px-8 py-4 font-medium lg:font-semibold rounded-2xl transition-all duration-200 border-2"
              [style.border-color]="'var(--border-primary)'" [style.color]="'var(--text-primary)'"
              [style.background-color]="'transparent'">
              @if (isSaving) {
              <div
                class="inline-block w-5 h-5 border-2 border-current border-t-transparent rounded-full animate-spin mr-3">
              </div>
              }
              {{ isSaving ? 'Saving...' : 'Save Changes' }}
            </button>
            }

            <button type="submit" [disabled]="isSubmitting || !validateForm()"
              class="flex-1 lg:flex-none flex items-center justify-center px-8 lg:px-12 py-4 text-white font-medium lg:font-semibold rounded-2xl transition-all duration-300 transform hover:scale-105 active:scale-95"
              [style.background-color]="'var(--bg-accent)'"
              [style.opacity]="(isSubmitting || !validateForm()) ? '0.6' : '1'">
              @if (isSubmitting) {
              <div
                class="inline-block w-5 h-5 border-2 border-current border-t-transparent rounded-full animate-spin mr-3">
              </div>
              }
              {{ isSubmitting ? 'Submitting...' : (isResubmitMode ? 'Resubmit for Review' : 'Submit for Review') }}
            </button>
            }
          </div>
          }
        </div>
      </div>
      }
    </form>
    }
  </div>
</div>
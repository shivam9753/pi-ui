<header class="bg-themed border-b border-themed relative z-50">
  <div class="px-6 mx-auto sm:px-8 lg:px-16 xl:px-24">
    <div class="flex items-center justify-between h-16 lg:h-20">

      <!-- Logo -->
      <a routerLink="/" class="flex items-center">
        <img src="assets/poemsindia-logo.png" alt="PoemsIndia" class="h-30 w-auto" />
      </a>

      <!-- ================= DESKTOP NAV ================= -->
      <nav aria-label="Main navigation" class="hidden lg:flex flex-1 justify-center items-center space-x-6">
        <a routerLink="/explore" routerLinkActive="nav-active" [routerLinkActiveOptions]="{ exact: true }"
          class="nav-item">
          Explore
        </a>

        <div class="relative group">
          <button class="nav-item flex items-center gap-1 whitespace-nowrap">
            <span>Featured</span>
            <svg class="inline-block w-3 h-3 ml-1 self-center" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.27a.75.75 0 01.02-1.06z" />
            </svg>
          </button>

          <div class="absolute mt-2 w-44 bg-themed-card border border-themed rounded shadow z-50 opacity-0 invisible group-hover:visible group-hover:opacity-100 group-hover:translate-y-0 transform transition-all">
            <ul class="py-1">
              <li>
                <a routerLink="/featured-poems" (click)="$event.preventDefault()" class="block px-3 py-2 text-sm hover:bg-themed-hover">Poems</a>
              </li>
              <li>
                <a routerLink="/published-authors" (click)="$event.preventDefault()" class="block px-3 py-2 text-sm hover:bg-themed-hover">Poets & Writers</a>
              </li>
            </ul>
          </div>
        </div>

        <a routerLink="/submission" routerLinkActive="nav-active" [routerLinkActiveOptions]="{ exact: true }" class="nav-item">
          Submit
        </a>

        <!-- Editorial dropdown - groups Submissions, Workspace, Admin -->
        @if (hasEditorialItems()) {
        <div class="relative" data-dropdown="editorial">
          <button (click)="toggleEditorialDropdown(); $event.stopPropagation()" class="nav-item flex items-center gap-1 whitespace-nowrap">
            <span>Editorial</span>
            <svg class="inline-block w-3 h-3 ml-1 self-center transition-transform" [ngClass]="{'rotate-180': showEditorialDropdown()}" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.27a.75.75 0 01.02-1.06z" />
            </svg>
          </button>

          @if (showEditorialDropdown()) {
          <div class="absolute mt-2 w-44 bg-themed-card border border-themed rounded shadow z-50">
            <ul class="py-1">
              @if (canAccessWorkspace() || isAdmin()) {
              <li>
                <a routerLink="/admin/submissions" (click)="closeEditorialDropdown()" class="block px-3 py-2 text-sm hover:bg-themed-hover">Submissions</a>
              </li>
              }
              @if (canAccessWorkspace()) {
              <li>
                <a routerLink="/workspace" (click)="closeEditorialDropdown()" class="block px-3 py-2 text-sm hover:bg-themed-hover">Pending Reviews</a>
              </li>
              }
            </ul>
          </div>
          }
        </div>
        }
      </nav>

      <!-- ================= RIGHT ACTIONS ================= -->
      <div class="flex items-center gap-3">

        <!-- DESKTOP SEARCH -->
        <div class="hidden lg:flex items-center bg-themed-card rounded-md px-3 py-1 border border-themed">
          <form (submit)="openSearchWithQuery(searchInput.value); $event.preventDefault()" class="flex items-center gap-2">
            <svg class="w-4 h-4 text-themed-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
            <input #searchInput type="search" placeholder="Search poems, authors..." class="ml-2 bg-transparent outline-none text-sm w-64" />
          </form>
        </div>

        <!-- AUTH (DESKTOP) -->
        @if (isBrowser() && authChecked()) {
        @if (!isAuthenticated()) {

        <!-- Login -->
        <a routerLink="/login" class="hidden lg:inline-flex px-5 py-2 text-sm font-semibold
                     rounded-full border border-themed hover:bg-themed-hover">
          Login
        </a>

        } @else {

        <!-- User Dropdown -->
        <div class="relative hidden lg:block" data-dropdown="user">
          <div class="flex items-center gap-2">
            <button (click)="toggleDropdown(); $event.stopPropagation()"
              class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-themed-hover" aria-haspopup="true"
              [attr.aria-expanded]="showDropdown()">
              <span class="text-sm font-medium">
                {{ loggedInUser()!.name }}
              </span>

              <svg class="w-4 h-4 transition-transform" [ngClass]="{ 'rotate-180': showDropdown() }" fill="none"
                stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
              </svg>
            </button>

            <!-- Admin quick access icon (desktop) placed outside the dropdown as requested -->
            <a *ngIf="isAdmin()" routerLink="/admin" (click)="closeDropdown(); $event.stopPropagation()" title="Admin" class="ml-2 p-1 rounded hover:bg-themed-hover inline-flex items-center">
              <!-- lock-like icon per request -->
              <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z" />
              </svg>
            </a>
          </div>

          @if (showDropdown()) {
          <div class="absolute right-0 mt-2 w-56 bg-themed-card
                       border border-themed rounded-lg shadow-lg overflow-hidden">

            <!-- User Info -->
            <div class="px-4 py-3 border-b border-themed">
              <p class="text-lg font-semibold m-0">{{ loggedInUser()!.name }}</p>
            </div>

            <a [routerLink]="['/user-profile', userId]" (click)="closeDropdown()"
              class="block px-4 py-2 text-sm hover:bg-themed-hover">
              My Profile
            </a>

            <a routerLink="/my-submissions" (click)="closeDropdown()"
              class="block px-4 py-2 text-sm hover:bg-themed-hover">
              My Submissions
            </a>

            <a routerLink="/whats-new" (click)="closeDropdown()" class="block px-4 py-2 text-sm hover:bg-themed-hover">
              Whatâ€™s New
            </a>

            <div class="flex items-center justify-between px-4 py-2 hover:bg-themed-hover">
              <span class="text-sm">Theme</span>
              <app-theme-toggle></app-theme-toggle>
            </div>

            <div class="border-t border-themed my-1"></div>

            <button (click)="logout()" class="w-full text-left px-4 py-2 text-sm
                         text-red-600 hover:bg-themed-hover">
              Logout
            </button>
          </div>
          }
        </div>

        }
        }

        <!-- MOBILE SEARCH -->
        <button (click)="openSearchDrawer()" aria-label="Search"
          class="lg:hidden p-2 text-themed-secondary hover:text-themed">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
        </button>

        <!-- MOBILE HAMBURGER -->
        <button (click)="toggleMobileMenu()" aria-label="Open menu"
          class="lg:hidden p-2 text-themed-secondary hover:text-themed">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>

      </div>
    </div>
  </div>
</header>

<!-- Mobile Search Drawer (mobile only) -->
<div *ngIf="showSearchDrawer()" class="fixed inset-0 z-50 lg:hidden">
  <button type="button" aria-label="Close search drawer" class="absolute inset-0 bg-black/60" (click)="showSearchDrawer.set(false)" (keydown.escape)="showSearchDrawer.set(false)"></button>
  <!-- Anchor the panel under the header (top-16 matches header height) -->
  <div class="absolute top-16 left-0 right-0 bg-themed-card border-b border-themed p-4 shadow-md">
    <app-search-overlay placeholder="Search poems, authors..." [showClose]="true"
      (search)="onSearchFromOverlay($event)" (close)="showSearchDrawer.set(false)">
    </app-search-overlay>
  </div>
</div>

<!-- ================= MOBILE OVERLAY ================= -->
@if (isMobileMenuOpen()) {
<button type="button" aria-label="Close mobile menu" class="fixed inset-0 bg-black/60 z-40 lg:hidden" (click)="closeMobileMenu()" (keydown.escape)="closeMobileMenu()"></button>
}

<!-- ================= MOBILE MENU (UPDATED) ================= -->
<div class="fixed top-0 right-0 w-80 h-full bg-white border-l border-themed z-50 shadow-lg
         transform transition-transform duration-300 lg:hidden" [ngClass]="{
    'translate-x-0': isMobileMenuOpen(),
    'translate-x-full': !isMobileMenuOpen()
  }">

  <nav aria-label="Mobile navigation" class="p-4 h-full flex flex-col">

    <!-- Name row with close button aligned to right (no logo on top) -->
    @if (isAuthenticated()) {
    <div class="flex items-center justify-between mb-3" style="align-items:flex-start;">
      <div class="flex items-center gap-3">
        <!-- Avatar: use initials avatar (prefer initials to avoid broken external images) -->
        <div class="w-9 h-9 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center text-sm font-semibold text-gray-800 dark:text-gray-100">
          {{ getUserInitials($any(loggedInUser())?.name || '') }}
        </div>

        <p class="m-0 text-[18px] leading-[1.15] font-semibold text-neutral-900 dark:text-neutral-100">{{ $any(loggedInUser()).name }}</p>
        <a *ngIf="isAdmin()" routerLink="/admin" (click)="closeMobileMenu()" class="ml-3 p-1 rounded hover:bg-gray-100 inline-flex items-center" title="Admin">
          <svg class="w-5 h-5 text-neutral-700" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z" />
          </svg>
        </a>
      </div>

      <button (click)="closeMobileMenu()" aria-label="Close menu" class="text-neutral-500 ml-3" style="background:none;border:0;padding:6px;">
        <svg class="w-5 h-5" fill="none" stroke="#374151" viewBox="0 0 24 24">
          <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    }

    <div style="flex:1; overflow:auto;">
      <ul style="margin:0;padding:0;list-style:none;">
        <li class="pt-2 pb-2 border-t" style="border-top-color:rgba(0,0,0,0.04);">
          <a routerLink="/explore" (click)="closeMobileMenu()" class="text-base font-medium text-neutral-900 dark:text-neutral-100 no-underline">Explore</a>
        </li>

        <li class="pt-2 pb-2 border-t" style="border-top-color:rgba(0,0,0,0.04);">
          <details style="margin:0;">
            <summary class="flex items-center justify-between cursor-pointer py-2" style="display:flex;align-items:center;justify-content:space-between;width:100%;padding:0;">
              <span class="text-base font-medium nav-item">Featured</span>
              <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" style="width:16px;height:16px;">
                <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
              </svg>
            </summary>

            <div class="mt-1 pl-1 flex flex-col gap-2">
              <a routerLink="/featured-poems" (click)="closeMobileMenu()" class="text-base text-neutral-900 dark:text-neutral-100 no-underline">Poems</a>
              <a routerLink="/published-authors" (click)="closeMobileMenu()" class="text-base text-neutral-900 dark:text-neutral-100 no-underline">Poets &amp; Writers</a>
            </div>
          </details>
        </li>

        <li class="pt-2 pb-2 border-t" style="border-top-color:rgba(0,0,0,0.04);">
          <a (click)="handleSubmitClick(); closeMobileMenu()" class="text-base font-medium text-neutral-900 dark:text-neutral-100 no-underline">Submit</a>
        </li>

        @if (hasEditorialItems()) {
        <li class="pt-2 pb-2 border-t" style="border-top-color:rgba(0,0,0,0.04);">
          <details style="margin:0;">
            <summary class="flex items-center justify-between cursor-pointer py-2" style="display:flex;align-items:center;justify-content:space-between;width:100%;padding:0;">
              <span class="text-base font-medium nav-item">Editorial</span>
              <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" style="width:16px;height:16px;">
                <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
              </svg>
            </summary>

            <div class="mt-1 pl-1 flex flex-col gap-2">
              @if (canAccessWorkspace() || isAdmin()) {
              <a routerLink="/admin/submissions" (click)="closeMobileMenu()" class="text-base text-neutral-900 dark:text-neutral-100 no-underline">Submissions</a>
              }
              @if (canAccessWorkspace()) {
              <a routerLink="/workspace" (click)="closeMobileMenu()" class="text-base text-neutral-900 dark:text-neutral-100 no-underline">Pending Reviews</a>
              }
            </div>
          </details>
        </li>
        }

        <li class="pt-2 pb-2 border-t" style="border-top-color:rgba(0,0,0,0.04);">
          <a [routerLink]="['/user-profile', userId]" (click)="closeMobileMenu()" class="text-base text-neutral-900 dark:text-neutral-100 no-underline">My Profile</a>
        </li>

        <li class="pt-2 pb-2 border-t" style="border-top-color:rgba(0,0,0,0.04);">
          <a routerLink="/my-submissions" (click)="closeMobileMenu()" class="text-base text-neutral-900 dark:text-neutral-100 no-underline">My Submissions</a>
        </li>
      </ul>
    </div>

    <!-- Theme toggle (mobile) -->
    <div class="border-t border-themed my-2" style="margin-top:8px;padding-top:10px;"></div>
    <div class="flex items-center justify-between px-0 py-2" style="padding-bottom:6px;padding-top:6px;">
      <span class="text-sm text-neutral-600 dark:text-neutral-300">Theme</span>
      <app-theme-toggle></app-theme-toggle>
    </div>

    <!-- Footer (two-column) -->
    <div style="margin-top:8px;border-top:1px solid rgba(0,0,0,0.06);padding-top:12px;font-size:13px;">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;color:var(--muted);">
        <a routerLink="/faqs" (click)="closeMobileMenu()" class="text-neutral-600 dark:text-neutral-400">FAQs</a>
        <a routerLink="/contact" (click)="closeMobileMenu()" class="text-neutral-600 dark:text-neutral-400">Contact</a>
        <a routerLink="/about" (click)="closeMobileMenu()" class="text-neutral-600 dark:text-neutral-400">About us</a>
        <a routerLink="/support" (click)="closeMobileMenu()" class="text-neutral-600 dark:text-neutral-400">Support</a>
        <a routerLink="/legal" (click)="closeMobileMenu()" class="text-neutral-600 dark:text-neutral-400">Terms &amp; Privacy</a>
        <a routerLink="/sitemap" (click)="closeMobileMenu()" class="text-neutral-600 dark:text-neutral-400">Sitemap</a>
        <a routerLink="/careers" (click)="closeMobileMenu()" class="text-neutral-600 dark:text-neutral-400">Careers</a>
        <a routerLink="/cookie-settings" (click)="closeMobileMenu()" class="text-neutral-600 dark:text-neutral-400">Cookie settings</a>
      </div>
    </div>

  </nav>
</div>